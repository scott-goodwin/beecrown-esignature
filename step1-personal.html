<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Onboarding - Step 1</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div class="document-container progress-container">
            <div class="progress-text" id="progressText"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Step 1 Content -->
        <div class="document-container">
            <div class="logo-container">
                <div class="logo-text-main">Beecrown</div>
                <div class="logo-text-sub">LOGISTICS LTD</div>
                <div class="logo-text-tagline">THE POWER OF DELIVERY</div>
            </div>

            <h1 style="text-align: center; color: var(--beecrown-purple); margin-bottom: 0.5rem;">Driver Onboarding</h1>
            <p style="text-align: center; color: #666; margin-bottom: 2rem;">Please complete all information to begin your onboarding process</p>

            <form id="initialForm">
                <div class="general-error" id="generalError">
                    ⚠️ Please fill in all required fields before continuing
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name <span class="required">*</span></label>
                        <input type="text" id="firstName" required>
                        <div class="form-error" id="firstNameError">First name is required</div>
                    </div>

                    <div class="form-group">
                        <label for="lastName">Last Name <span class="required">*</span></label>
                        <input type="text" id="lastName" required>
                        <div class="form-error" id="lastNameError">Last name is required</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email Address <span class="required">*</span></label>
                        <input type="email" id="email" required>
                        <div class="form-error" id="emailError">Valid email is required</div>
                    </div>

                    <div class="form-group">
                        <label for="phone">Contact Number <span class="required">*</span></label>
                        <input type="tel" id="phone" required>
                        <div class="form-error" id="phoneError">Contact number is required</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                        <input type="date" id="dateOfBirth" required>
                        <div class="form-error" id="dateOfBirthError">Date of birth is required</div>
                    </div>

                    <div class="form-group">
                        <label for="nationalInsurance">National Insurance Number <span class="required">*</span></label>
                        <input type="text" id="nationalInsurance" required placeholder="e.g., AB123456C">
                        <div class="form-error" id="nationalInsuranceError">National Insurance number is required</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="driverReference">Driver Reference <span class="required">*</span></label>
                    <input type="text" id="driverReference" required placeholder="e.g., DRV-12345">
                    <div class="form-error" id="driverReferenceError">Driver reference is required</div>
                </div>

                <h3 style="color: var(--beecrown-purple); margin: 2rem 0 1rem 0;">Current Address</h3>

                <div class="form-group">
                    <label for="addressLine1">Address Line 1 <span class="required">*</span></label>
                    <input type="text" id="addressLine1" required>
                    <div class="form-error" id="addressLine1Error">Address line 1 is required</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="town">Town/City <span class="required">*</span></label>
                        <input type="text" id="town" required>
                        <div class="form-error" id="townError">Town/City is required</div>
                    </div>

                    <div class="form-group">
                        <label for="postcode">Postcode <span class="required">*</span></label>
                        <input type="text" id="postcode" required placeholder="e.g., BL1 4DH">
                        <div class="form-error" id="postcodeError">Postcode is required</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="yearsAtAddress1">Years at Current Address <span class="required">*</span></label>
                    <input type="number" id="yearsAtAddress1" required min="0" step="0.5" placeholder="e.g., 5">
                    <div class="form-error" id="yearsAtAddress1Error">Years at address is required</div>
                </div>

                <h3 style="color: var(--beecrown-purple); margin: 2rem 0 1rem 0;">Address History (7 Year History Required)</h3>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Please provide your previous addresses if you have lived at your current address for less than 7 years.</p>

                <div class="address-history-section" style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--beecrown-purple); margin-bottom: 0.5rem; font-size: 1rem;">Previous Address 1</h4>
                    <div class="form-group">
                        <label for="address2">Address</label>
                        <input type="text" id="address2">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="town2">Town/City</label>
                            <input type="text" id="town2">
                        </div>
                        <div class="form-group">
                            <label for="postcode2">Postcode</label>
                            <input type="text" id="postcode2" placeholder="e.g., BL1 4DH">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="yearsAtAddress2">Years at this address</label>
                        <input type="number" id="yearsAtAddress2" min="0" step="0.5" placeholder="e.g., 3">
                    </div>
                </div>

                <div class="address-history-section" style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--beecrown-purple); margin-bottom: 0.5rem; font-size: 1rem;">Previous Address 2</h4>
                    <div class="form-group">
                        <label for="address3">Address</label>
                        <input type="text" id="address3">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="town3">Town/City</label>
                            <input type="text" id="town3">
                        </div>
                        <div class="form-group">
                            <label for="postcode3">Postcode</label>
                            <input type="text" id="postcode3" placeholder="e.g., BL1 4DH">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="yearsAtAddress3">Years at this address</label>
                        <input type="number" id="yearsAtAddress3" min="0" step="0.5" placeholder="e.g., 2">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Continue to Deduction Form</button>
            </form>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p id="loadingText">Processing...</p>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        // Initialize progress
        progress.update(1, 11);

        // Handle form submission
        document.getElementById('initialForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Clear errors
            validation.clearErrors();

            // Collect data
            const data = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                dateOfBirth: document.getElementById('dateOfBirth').value,
                nationalInsurance: document.getElementById('nationalInsurance').value.trim().toUpperCase(),
                driverReference: document.getElementById('driverReference').value.trim().toUpperCase(),
                // Current address (Address 1)
                addressLine1: document.getElementById('addressLine1').value.trim(),
                town: document.getElementById('town').value.trim(),
                postcode: document.getElementById('postcode').value.trim().toUpperCase(),
                yearsAtAddress1: document.getElementById('yearsAtAddress1').value.trim(),
                // Previous Address 1 (Address 2)
                address2: document.getElementById('address2').value.trim(),
                town2: document.getElementById('town2').value.trim(),
                postcode2: document.getElementById('postcode2').value.trim().toUpperCase(),
                yearsAtAddress2: document.getElementById('yearsAtAddress2').value.trim(),
                // Previous Address 2 (Address 3)
                address3: document.getElementById('address3').value.trim(),
                town3: document.getElementById('town3').value.trim(),
                postcode3: document.getElementById('postcode3').value.trim().toUpperCase(),
                yearsAtAddress3: document.getElementById('yearsAtAddress3').value.trim()
            };

            // Generate derived fields
            data.fullName = `${data.firstName} ${data.lastName}`;
            
            let formattedAddress = data.addressLine1;
            formattedAddress += `\n${data.town}\n${data.postcode}`;
            data.formattedAddress = formattedAddress;

            // Validate
            let hasErrors = false;
            const required = ['firstName', 'lastName', 'email', 'phone', 'dateOfBirth', 'nationalInsurance', 'driverReference', 'addressLine1', 'town', 'postcode', 'yearsAtAddress1'];
            
            required.forEach(field => {
                if (!data[field]) {
                    const fieldLabel = field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    validation.showError(field, `${fieldLabel} is required`);
                    hasErrors = true;
                }
            });

            // Validate 7-year address history requirement
            const yearsAtAddress1 = parseFloat(data.yearsAtAddress1) || 0;
            const yearsAtAddress2 = parseFloat(data.yearsAtAddress2) || 0;
            const yearsAtAddress3 = parseFloat(data.yearsAtAddress3) || 0;
            const totalYears = yearsAtAddress1 + yearsAtAddress2 + yearsAtAddress3;

            if (totalYears < 7) {
                // Check if previous addresses are provided when needed
                if (yearsAtAddress1 < 7) {
                    if (!data.address2 || !data.town2 || !data.postcode2 || !data.yearsAtAddress2) {
                        validation.showError('address2', 'Please provide at least one previous address to complete 7-year history');
                        hasErrors = true;
                    }
                }
            }

            // Email validation
            if (data.email && !validation.validateEmail(data.email)) {
                validation.showError('email', 'Please enter a valid email address');
                hasErrors = true;
            }

            if (hasErrors) {
                validation.showGeneralError();
                utils.scrollToTop();
                return;
            }

            // Save to session storage
            storage.save(data);

            // Navigate to next step (Deduction Form)
            navigation.goToStep(2);
        });
    </script>
</body>
</html>
